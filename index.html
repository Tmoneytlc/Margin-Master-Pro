<!DOCTYPE html>
<html>
<head>
    <title>Margin Master PRO</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f9;
            margin: 20px;
            color: #333;
        }
        input, button, label {
            padding: 8px;
            margin: 5px;
            display: block;
        }
        input[type="checkbox"] {
            display: inline-block;
            width: auto;
        }
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
        }
        button:hover {
            background-color: #45a049;
        }
        h1, h2 {
            color: #2c3e50;
        }
        @media only screen and (max-width: 600px) {
            body {
                background-color: #fff;
            }
            input, button {
                width: 100%;
                box-sizing: border-box;
            }
        }
    </style>
    <!-- Include the SheetJS library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.9/xlsx.full.min.js"></script>
</head>
<body>
    <h1>Margin Master PRO</h1>

    <!-- Gross Margin Calculation -->
    <h2>Gross Margin Calculator</h2>
    Sale Price: <input type="number" id="salePrice1">
    Cost: <input type="number" id="cost1">
    <button onclick="calculateGrossMargin()">Calculate Gross Margin</button>
    <p id="grossMarginResult"></p>

    <!-- Sale Price from Cost and Margin -->
    <h2>Sale Price Calculator</h2>
    Cost: <input type="number" id="cost2">
    Gross Margin (%): <input type="number" id="marginPercent">
    <button onclick="calculateSalePrice()">Calculate Sale Price</button>
    <p id="salePriceResult"></p>

    <!-- Cost from Sale Price and Margin -->
    <h2>Cost Calculator</h2>
    Sale Price: <input type="number" id="salePrice2">
    Gross Margin (%): <input type="number" id="marginPercent2">
    <button onclick="calculateCost()">Calculate Cost</button>
    <p id="costResult"></p>

    <!-- Price Adjustment -->
    <h2>Price Adjustment Calculator</h2>
    Original Price: <input type="number" id="originalPrice">
    Adjustment (%): <input type="number" id="adjustmentPercent">
    <button onclick="adjustPrice()">Adjust Price</button>
    <p id="adjustedPriceResult"></p>

    <!-- Percent Difference Calculation -->
    <h2>Percent Difference Calculator</h2>
    Number 1: <input type="number" id="number1">
    Number 2: <input type="number" id="number2">
    <button onclick="calculatePercentDifference()">Calculate Percent Difference</button>
    <p id="percentDifferenceResult"></p>

    <!-- Export Data -->
    <button onclick="exportData('csv')">Export to CSV</button>
    <button onclick="exportData('excel')">Export to Excel</button>

    <script>
        function calculateGrossMargin() {
            var salePrice = document.getElementById('salePrice1').value;
            var cost = document.getElementById('cost1').value;
            var grossMarginPercentage = ((salePrice - cost) / salePrice) * 100;
            var grossMarginDollars = salePrice - cost;
            document.getElementById('grossMarginResult').innerHTML = 'Gross Margin Percentage: ' + grossMarginPercentage.toFixed(2) + '%, Gross Margin Dollars: $' + grossMarginDollars.toFixed(2);
        }

        function calculateSalePrice() {
            var cost = document.getElementById('cost2').value;
            var marginPercent = document.getElementById('marginPercent').value;
            var salePrice = cost / (1 - marginPercent / 100);
            document.getElementById('salePriceResult').innerHTML = 'Sale Price: $' + salePrice.toFixed(2);
        }

        function calculateCost() {
            var salePrice = document.getElementById('salePrice2').value;
            var marginPercent = document.getElementById('marginPercent2').value;
            var cost = salePrice - (salePrice * marginPercent / 100);
            document.getElementById('costResult').innerHTML = 'Cost: $' + cost.toFixed(2);
        }

        function adjustPrice() {
            var originalPrice = document.getElementById('originalPrice').value;
            var adjustmentPercent = document.getElementById('adjustmentPercent').value;
            var adjustedPrice = originalPrice * (1 + adjustmentPercent / 100);
            document.getElementById('adjustedPriceResult').innerHTML = 'Adjusted Price: $' + adjustedPrice.toFixed(2);
        }

        function calculatePercentDifference() {
            var number1 = document.getElementById('number1').value;
            var number2 = document.getElementById('number2').value;
            var difference = number2 - number1;
            var percentDifference = (difference / number1) * 100;
            document.getElementById('percentDifferenceResult').innerHTML = 'Difference: ' + difference.toFixed(2) + ', Percent Difference: ' + percentDifference.toFixed(2) + '%';
        }

        function exportData(format) {
            var data = [
                ['Gross Margin Percentage', document.getElementById('grossMarginResult').innerText],
                ['Sale Price', document.getElementById('salePriceResult').innerText],
                ['Cost', document.getElementById('costResult').innerText],
                ['Adjusted Price', document.getElementById('adjustedPriceResult').innerText],
                ['Percent Difference', document.getElementById('percentDifferenceResult').innerText]
            ];

            if (format === 'csv') {
                var csvContent = "data:text/csv;charset=utf-8," 
                    + data.map(e => e.join(",")).join("\n");
                var encodedUri = encodeURI(csvContent);
                var link = document.createElement("a");
                link.setAttribute("href", encodedUri);
                link.setAttribute("download", "financial_calculations.csv");
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            } else if (format === 'excel') {
                var ws = XLSX.utils.aoa_to_sheet(data);
                var wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, "Sheet1");
                XLSX.writeFile(wb, "financial_calculations.xlsx");
            }
        }
    </script>
</body>
</html>
